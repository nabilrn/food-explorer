<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/foodexplorer/ui/feed/FeedScreen.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/foodexplorer/ui/feed/FeedScreen.kt" />
              <option name="originalContent" value="package com.example.foodexplorer.ui.feed&#10;&#10;import androidx.compose.foundation.layout.Arrangement&#10;import androidx.compose.foundation.layout.Box&#10;import androidx.compose.foundation.layout.Column&#10;import androidx.compose.foundation.layout.Spacer&#10;import androidx.compose.foundation.layout.fillMaxSize&#10;import androidx.compose.foundation.layout.fillMaxWidth&#10;import androidx.compose.foundation.layout.height&#10;import androidx.compose.foundation.layout.padding&#10;import androidx.compose.foundation.layout.size&#10;import androidx.compose.foundation.lazy.LazyColumn&#10;import androidx.compose.foundation.lazy.items&#10;import androidx.compose.material3.CircularProgressIndicator&#10;import androidx.compose.material3.ExperimentalMaterial3Api&#10;import androidx.compose.material3.MaterialTheme&#10;import androidx.compose.material3.Text&#10;import androidx.compose.material3.TextButton&#10;import androidx.compose.material3.pulltorefresh.PullToRefreshBox&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.runtime.LaunchedEffect&#10;import androidx.compose.runtime.getValue&#10;import androidx.compose.runtime.mutableStateOf&#10;import androidx.compose.runtime.remember&#10;import androidx.compose.runtime.setValue&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.unit.dp&#10;import com.example.foodexplorer.data.model.MealFeedItem&#10;import com.example.foodexplorer.ui.components.Categories&#10;import com.example.foodexplorer.ui.components.SearchBar&#10;import com.example.foodexplorer.ui.components.TopBar&#10;&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun FeedScreen(&#10;    state: FeedUiState,&#10;    onMealClick: (String) -&gt; Unit,&#10;    onRefresh: () -&gt; Unit,&#10;    onToggleSave: (String) -&gt; Unit = {},&#10;    onCategoryClick: (String?) -&gt; Unit = {},&#10;    onSearchMeals: (String) -&gt; Unit = {},&#10;    onToggleSearchMode: () -&gt; Unit = {},&#10;    onShareMeal: (MealFeedItem) -&gt; Unit = {},&#10;    onLoadMore: () -&gt; Unit = {},&#10;    modifier: Modifier = Modifier&#10;) {&#10;    var searchQuery by remember { mutableStateOf(&quot;&quot;) }&#10;    var isRefreshing by remember { mutableStateOf(false) }&#10;&#10;    // Reset refreshing state when data is loaded&#10;    LaunchedEffect(state) {&#10;        if (state is FeedUiState.Success) {&#10;            isRefreshing = false&#10;        }&#10;    }&#10;&#10;    Column(modifier = modifier.fillMaxSize()) {&#10;        // TopBar with search icon or Search input&#10;        val currentState = state as? FeedUiState.Success&#10;&#10;        if (currentState?.isSearching == true) {&#10;            // Show search bar in header when search mode is active&#10;            SearchBar(&#10;                query = searchQuery,&#10;                onQueryChange = { searchQuery = it },&#10;                onSearch = { onSearchMeals(searchQuery) },&#10;                onClose = {&#10;                    searchQuery = &quot;&quot;&#10;                    onToggleSearchMode()&#10;                }&#10;            )&#10;        } else {&#10;            // Show normal TopBar with search icon&#10;            TopBar(&#10;                title = &quot;Food Explorer&quot;,&#10;                onSearchClick = {&#10;                    onToggleSearchMode()&#10;                },&#10;                isSearchMode = false&#10;            )&#10;        }&#10;&#10;        when (state) {&#10;            FeedUiState.Loading -&gt; {&#10;                Box(&#10;                    modifier = Modifier&#10;                        .fillMaxSize()&#10;                        .padding(16.dp),&#10;                    contentAlignment = Alignment.Center&#10;                ) {&#10;                    CircularProgressIndicator(&#10;                        color = MaterialTheme.colorScheme.primary,&#10;                        strokeWidth = 2.dp&#10;                    )&#10;                }&#10;            }&#10;&#10;            is FeedUiState.Error -&gt; {&#10;                PullToRefreshBox(&#10;                    isRefreshing = isRefreshing,&#10;                    onRefresh = {&#10;                        isRefreshing = true&#10;                        onRefresh()&#10;                    },&#10;                    modifier = Modifier.fillMaxSize()&#10;                ) {&#10;                    Column(&#10;                        modifier = Modifier&#10;                            .fillMaxSize()&#10;                            .padding(16.dp),&#10;                        verticalArrangement = Arrangement.Center,&#10;                        horizontalAlignment = Alignment.CenterHorizontally&#10;                    ) {&#10;                        Text(&#10;                            text = state.message,&#10;                            style = MaterialTheme.typography.bodyMedium,&#10;                            color = MaterialTheme.colorScheme.onSurfaceVariant&#10;                        )&#10;                        Spacer(modifier = Modifier.height(16.dp))&#10;                        TextButton(onClick = onRefresh) {&#10;                            Text(text = &quot;Retry&quot;)&#10;                        }&#10;                    }&#10;                }&#10;            }&#10;&#10;            is FeedUiState.Success -&gt; {&#10;                PullToRefreshBox(&#10;                    isRefreshing = isRefreshing,&#10;                    onRefresh = {&#10;                        isRefreshing = true&#10;                        onRefresh()&#10;                    },&#10;                    modifier = Modifier.fillMaxSize()&#10;                ) {&#10;                    LazyColumn(&#10;                        modifier = Modifier.fillMaxSize(),&#10;                        verticalArrangement = Arrangement.spacedBy(0.dp)&#10;                    ) {&#10;&#10;                        // Show categories only when not searching&#10;                        if (!state.isSearching) {&#10;                            item {&#10;                                Spacer(modifier = Modifier.height(8.dp))&#10;                                Categories(&#10;                                    categories = state.categories,&#10;                                    selectedCategory = state.selectedCategory,&#10;                                    onCategoryClick = onCategoryClick&#10;                                )&#10;                                Spacer(modifier = Modifier.height(8.dp))&#10;                            }&#10;                        }&#10;&#10;                        // Show loading indicator when filtering category&#10;                        if (state.isLoadingCategory) {&#10;                            item {&#10;                                Box(&#10;                                    modifier = Modifier&#10;                                        .fillMaxWidth()&#10;                                        .padding(32.dp),&#10;                                    contentAlignment = Alignment.Center&#10;                                ) {&#10;                                    CircularProgressIndicator(&#10;                                        color = MaterialTheme.colorScheme.primary,&#10;                                        strokeWidth = 2.dp&#10;                                    )&#10;                                }&#10;                            }&#10;                        } else {&#10;                            items(state.meals) { meal -&gt;&#10;                                FeedItem(&#10;                                    meal = meal,&#10;                                    isSaved = meal.idMeal in state.savedMealIds,&#10;                                    onMealClick = onMealClick,&#10;                                    onToggleSave = onToggleSave,&#10;                                    onShare = onShareMeal&#10;                                )&#10;                            }&#10;&#10;                            // Load more indicator and trigger&#10;                            if (!state.isSearching &amp;&amp; state.selectedCategory == null) {&#10;                                item {&#10;                                    if (state.isLoadingMore) {&#10;                                        Box(&#10;                                            modifier = Modifier&#10;                                                .fillMaxWidth()&#10;                                                .padding(16.dp),&#10;                                            contentAlignment = Alignment.Center&#10;                                        ) {&#10;                                            CircularProgressIndicator(&#10;                                                color = MaterialTheme.colorScheme.primary,&#10;                                                strokeWidth = 2.dp,&#10;                                                modifier = Modifier.size(24.dp)&#10;                                            )&#10;                                        }&#10;                                    } else {&#10;                                        // Trigger load more when this item is visible&#10;                                        LaunchedEffect(Unit) {&#10;                                            onLoadMore()&#10;                                        }&#10;                                        Spacer(modifier = Modifier.height(16.dp))&#10;                                    }&#10;                                }&#10;                            }&#10;                        }&#10;                    }&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.foodexplorer.ui.feed&#10;&#10;import androidx.compose.foundation.layout.Arrangement&#10;import androidx.compose.foundation.layout.Box&#10;import androidx.compose.foundation.layout.Column&#10;import androidx.compose.foundation.layout.Spacer&#10;import androidx.compose.foundation.layout.fillMaxSize&#10;import androidx.compose.foundation.layout.fillMaxWidth&#10;import androidx.compose.foundation.layout.height&#10;import androidx.compose.foundation.layout.padding&#10;import androidx.compose.foundation.layout.size&#10;import androidx.compose.foundation.lazy.LazyColumn&#10;import androidx.compose.foundation.lazy.items&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.outlined.SearchOff&#10;import androidx.compose.material3.CircularProgressIndicator&#10;import androidx.compose.material3.ExperimentalMaterial3Api&#10;import androidx.compose.material3.Icon&#10;import androidx.compose.material3.MaterialTheme&#10;import androidx.compose.material3.Text&#10;import androidx.compose.material3.TextButton&#10;import androidx.compose.material3.pulltorefresh.PullToRefreshBox&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.runtime.LaunchedEffect&#10;import androidx.compose.runtime.getValue&#10;import androidx.compose.runtime.mutableStateOf&#10;import androidx.compose.runtime.remember&#10;import androidx.compose.runtime.setValue&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.unit.dp&#10;import com.example.foodexplorer.data.model.MealFeedItem&#10;import com.example.foodexplorer.ui.components.Categories&#10;import com.example.foodexplorer.ui.components.SearchBar&#10;import com.example.foodexplorer.ui.components.TopBar&#10;import kotlinx.coroutines.delay&#10;&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun FeedScreen(&#10;    state: FeedUiState,&#10;    onMealClick: (String) -&gt; Unit,&#10;    onRefresh: () -&gt; Unit,&#10;    onToggleSave: (String) -&gt; Unit = {},&#10;    onCategoryClick: (String?) -&gt; Unit = {},&#10;    onSearchMeals: (String) -&gt; Unit = {},&#10;    onToggleSearchMode: () -&gt; Unit = {},&#10;    onShareMeal: (MealFeedItem) -&gt; Unit = {},&#10;    onLoadMore: () -&gt; Unit = {},&#10;    modifier: Modifier = Modifier&#10;) {&#10;    var searchQuery by remember { mutableStateOf(&quot;&quot;) }&#10;    var isRefreshing by remember { mutableStateOf(false) }&#10;&#10;    // Debounced search - auto search after user stops typing for 600ms&#10;    LaunchedEffect(searchQuery) {&#10;        if (searchQuery.isNotEmpty() &amp;&amp; searchQuery.length &gt;= 2) {&#10;            delay(600) // Wait 600ms after user stops typing&#10;            onSearchMeals(searchQuery)&#10;        }&#10;    }&#10;&#10;    // Reset refreshing state when data is loaded&#10;    LaunchedEffect(state) {&#10;        if (state is FeedUiState.Success) {&#10;            isRefreshing = false&#10;        }&#10;    }&#10;&#10;    Column(modifier = modifier.fillMaxSize()) {&#10;        // TopBar with search icon or Search input&#10;        val currentState = state as? FeedUiState.Success&#10;&#10;        if (currentState?.isSearching == true) {&#10;            // Show search bar in header when search mode is active&#10;            SearchBar(&#10;                query = searchQuery,&#10;                onQueryChange = { searchQuery = it },&#10;                onSearch = {&#10;                    // Manual search when Enter is pressed&#10;                    if (searchQuery.isNotEmpty()) {&#10;                        onSearchMeals(searchQuery)&#10;                    }&#10;                },&#10;                onClose = {&#10;                    searchQuery = &quot;&quot;&#10;                    onToggleSearchMode()&#10;                },&#10;                placeholder = &quot;Type to search (min. 2 characters)...&quot;&#10;            )&#10;        } else {&#10;            // Show normal TopBar with search icon&#10;            TopBar(&#10;                title = &quot;Food Explorer&quot;,&#10;                onSearchClick = {&#10;                    onToggleSearchMode()&#10;                },&#10;                isSearchMode = false&#10;            )&#10;        }&#10;&#10;        when (state) {&#10;            FeedUiState.Loading -&gt; {&#10;                Box(&#10;                    modifier = Modifier&#10;                        .fillMaxSize()&#10;                        .padding(16.dp),&#10;                    contentAlignment = Alignment.Center&#10;                ) {&#10;                    CircularProgressIndicator(&#10;                        color = MaterialTheme.colorScheme.primary,&#10;                        strokeWidth = 2.dp&#10;                    )&#10;                }&#10;            }&#10;&#10;            is FeedUiState.Error -&gt; {&#10;                PullToRefreshBox(&#10;                    isRefreshing = isRefreshing,&#10;                    onRefresh = {&#10;                        isRefreshing = true&#10;                        onRefresh()&#10;                    },&#10;                    modifier = Modifier.fillMaxSize()&#10;                ) {&#10;                    Column(&#10;                        modifier = Modifier&#10;                            .fillMaxSize()&#10;                            .padding(16.dp),&#10;                        verticalArrangement = Arrangement.Center,&#10;                        horizontalAlignment = Alignment.CenterHorizontally&#10;                    ) {&#10;                        Text(&#10;                            text = state.message,&#10;                            style = MaterialTheme.typography.bodyMedium,&#10;                            color = MaterialTheme.colorScheme.onSurfaceVariant&#10;                        )&#10;                        Spacer(modifier = Modifier.height(16.dp))&#10;                        TextButton(onClick = onRefresh) {&#10;                            Text(text = &quot;Retry&quot;)&#10;                        }&#10;                    }&#10;                }&#10;            }&#10;&#10;            is FeedUiState.Success -&gt; {&#10;                PullToRefreshBox(&#10;                    isRefreshing = isRefreshing,&#10;                    onRefresh = {&#10;                        isRefreshing = true&#10;                        onRefresh()&#10;                    },&#10;                    modifier = Modifier.fillMaxSize()&#10;                ) {&#10;                    LazyColumn(&#10;                        modifier = Modifier.fillMaxSize(),&#10;                        verticalArrangement = Arrangement.spacedBy(0.dp)&#10;                    ) {&#10;&#10;                        // Show categories only when not searching&#10;                        if (!state.isSearching) {&#10;                            item {&#10;                                Spacer(modifier = Modifier.height(8.dp))&#10;                                Categories(&#10;                                    categories = state.categories,&#10;                                    selectedCategory = state.selectedCategory,&#10;                                    onCategoryClick = onCategoryClick&#10;                                )&#10;                                Spacer(modifier = Modifier.height(8.dp))&#10;                            }&#10;                        }&#10;&#10;                        // Show loading indicator when filtering category&#10;                        if (state.isLoadingCategory) {&#10;                            item {&#10;                                Box(&#10;                                    modifier = Modifier&#10;                                        .fillMaxWidth()&#10;                                        .padding(32.dp),&#10;                                    contentAlignment = Alignment.Center&#10;                                ) {&#10;                                    CircularProgressIndicator(&#10;                                        color = MaterialTheme.colorScheme.primary,&#10;                                        strokeWidth = 2.dp&#10;                                    )&#10;                                }&#10;                            }&#10;                        } else {&#10;                            // Show empty state if no meals found&#10;                            if (state.meals.isEmpty()) {&#10;                                item {&#10;                                    Box(&#10;                                        modifier = Modifier&#10;                                            .fillMaxWidth()&#10;                                            .padding(64.dp),&#10;                                        contentAlignment = Alignment.Center&#10;                                    ) {&#10;                                        Column(&#10;                                            horizontalAlignment = Alignment.CenterHorizontally,&#10;                                            verticalArrangement = Arrangement.Center&#10;                                        ) {&#10;                                            if (state.isSearching) {&#10;                                                Icon(&#10;                                                    imageVector = Icons.Outlined.SearchOff,&#10;                                                    contentDescription = null,&#10;                                                    modifier = Modifier.size(64.dp),&#10;                                                    tint = MaterialTheme.colorScheme.onSurfaceVariant.copy(alpha = 0.4f)&#10;                                                )&#10;                                                Spacer(modifier = Modifier.height(16.dp))&#10;                                            }&#10;                                            Text(&#10;                                                text = if (state.isSearching) &quot;No meals found&quot; else &quot;No meals available&quot;,&#10;                                                style = MaterialTheme.typography.titleMedium,&#10;                                                color = MaterialTheme.colorScheme.onSurfaceVariant&#10;                                            )&#10;                                            Spacer(modifier = Modifier.height(8.dp))&#10;                                            Text(&#10;                                                text = if (state.isSearching) &#10;                                                    &quot;Try a different search term&quot; &#10;                                                else &#10;                                                    &quot;Pull down to refresh&quot;,&#10;                                                style = MaterialTheme.typography.bodyMedium,&#10;                                                color = MaterialTheme.colorScheme.onSurfaceVariant.copy(alpha = 0.7f)&#10;                                            )&#10;                                        }&#10;                                    }&#10;                                }&#10;                            } else {&#10;                                // Show meals list&#10;                                items(state.meals) { meal -&gt;&#10;                                    FeedItem(&#10;                                        meal = meal,&#10;                                        isSaved = meal.idMeal in state.savedMealIds,&#10;                                        onMealClick = onMealClick,&#10;                                        onToggleSave = onToggleSave,&#10;                                        onShare = onShareMeal&#10;                                    )&#10;                                }&#10;&#10;                                // Load more indicator and trigger&#10;                                if (!state.isSearching &amp;&amp; state.selectedCategory == null) {&#10;                                    item {&#10;                                        if (state.isLoadingMore) {&#10;                                            Box(&#10;                                                modifier = Modifier&#10;                                                    .fillMaxWidth()&#10;                                                    .padding(16.dp),&#10;                                                contentAlignment = Alignment.Center&#10;                                            ) {&#10;                                                CircularProgressIndicator(&#10;                                                    color = MaterialTheme.colorScheme.primary,&#10;                                                    strokeWidth = 2.dp,&#10;                                                    modifier = Modifier.size(24.dp)&#10;                                                )&#10;                                            }&#10;                                        } else {&#10;                                            // Trigger load more when this item is visible&#10;                                            LaunchedEffect(Unit) {&#10;                                                onLoadMore()&#10;                                            }&#10;                                            Spacer(modifier = Modifier.height(16.dp))&#10;                                        }&#10;                                    }&#10;                                }&#10;                            }&#10;                        }&#10;                    }&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>